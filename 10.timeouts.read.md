# Task #10: timeouts.read

## Summary

Implemented `timeouts.read` field by updating the variable definition in `variables.tf` with the correct default value extracted from the AzureRM provider source code. The read timeout defaults to 5 minutes.

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

From `resourceResourceGroup()`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(90 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(90 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(90 * time.Minute),
}
```

**Evidence:**
- Default value: **5 minutes**
- This is a resource-level meta-argument, not a request body property

## Provider Schema

From `github.com/hashicorp/terraform-provider-azurerm/internal/services/resource`:

```go
func resourceResourceGroup() *pluginsdk.Resource {
    return &pluginsdk.Resource{
        Create:   resourceResourceGroupCreate,
        Read:     resourceResourceGroupRead,
        Update:   resourceResourceGroupUpdate,
        Delete:   resourceResourceGroupDelete,
        Importer: pluginsdk.ImporterValidatingIdentity(&commonids.ResourceGroupId{}),

        Timeouts: &pluginsdk.ResourceTimeout{
            Create: pluginsdk.DefaultTimeout(90 * time.Minute),
            Read:   pluginsdk.DefaultTimeout(5 * time.Minute),  # <- Read timeout
            Update: pluginsdk.DefaultTimeout(90 * time.Minute),
            Delete: pluginsdk.DefaultTimeout(90 * time.Minute),
        },

        Schema: map[string]*pluginsdk.Schema{
            "name": commonschema.ResourceGroupName(),
            "location": commonschema.Location(),
            "tags": commonschema.Tags(),
            "managed_by": {
                Type:         pluginsdk.TypeString,
                Optional:     true,
                ValidateFunc: validation.StringIsNotEmpty,
            },
        },

        Identity: &schema.ResourceIdentity{
            SchemaFunc: pluginsdk.GenerateIdentitySchema(&commonids.ResourceGroupId{}),
        },
    }
}
```

**Key Evidence:**
- `Read: pluginsdk.DefaultTimeout(5 * time.Minute)` - Read operations default to 5 minutes

## Implementation

Updated `variables.tf`:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "90m")
    delete = optional(string, "90m")
    read   = optional(string, "5m")  # <- Added default from provider
    update = optional(string)
  })
  default = {
    create = "90m"
    delete = "90m"
    read   = "5m"  # <- Added to default block
  }
  nullable = false
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 90 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 90 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.  # <- Updated description
 - `update` - (Defaults to 90 minutes) Used when updating the Resource Group.
EOT
}
```

**Changes Made:**
1. Updated type definition: `read = optional(string, "5m")` - added default "5m"
2. Updated default block: Added `read = "5m"`
3. Updated description: Changed to "(Optional) Specifies the timeout for read operations. Defaults to 5 minutes."

**Synchronization Verified:**
- Type definition has: `optional(string, "5m")`
- Default block has: `read = "5m"`
- Both values match ✅

## Shadow Module Implementation

**No shadow module changes required.** The `timeouts` block is a Terraform provider meta-argument that is consumed directly by the parent module's `azapi_resource` block.

The `output "timeouts"` in `migrate_outputs.tf` already exists, allowing the parent module to pass the timeouts value directly:

```hcl
output "timeouts" {
  value = var.timeouts
}
```

## Critical Review & Edge Case

**Null Semantics:**
- The variable has `nullable = false`, so it cannot be null
- The `read` field uses `optional(string, "5m")`, providing a default when not explicitly set
- When omitted, Terraform will use "5m" as the default

**Edge Cases:**
- Empty string: Not applicable - timeout values must be valid duration strings
- Zero value: Not applicable - timeout must be a positive duration
- Provider behavior: Read operations will timeout after 5 minutes by default

**Idempotency:**
- Timeout values do not affect resource state, only operation duration limits
- Consistent behavior across applies

**Safe References:**
- Direct variable reference in output
- No nested access or null checks needed

## Completion Checklist

- ✅ Queried provider source code for timeout defaults
- ✅ Updated variable type definition with correct default: `optional(string, "5m")`
- ✅ Updated variable default block with correct timeout string: `read = "5m"`
- ✅ Verified synchronization between type definition and default block
- ✅ Updated variable description with correct default duration
- ✅ Confirmed `nullable = false` is set
- ✅ Verified `output "timeouts"` exists in migrate_outputs.tf
- ✅ Documented provider schema evidence in proof
- ✅ Confirmed no shadow module changes needed
- ✅ Created proof document
- ✅ Ready to update track.md status to Pending for check

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-23
**Task:** #10 - timeouts.read

### Validation Results

✅ **Override Document:** Correctly read and followed `timeouts.md` special rules
✅ **Provider Schema Query:** Complete resource function queried, found `Read: pluginsdk.DefaultTimeout(5 * time.Minute)`
✅ **Type Definition:** Correctly updated with `optional(string, "5m")`
✅ **Default Block:** Correctly updated with `read = "5m"`
✅ **Synchronization:** Type definition and default block values match exactly
✅ **nullable = false:** Explicitly set to prevent null values
✅ **Description:** Updated to reflect "Defaults to 5 minutes"
✅ **Output Configuration:** `output "timeouts"` already exists in migrate_outputs.tf
✅ **Shadow Module:** Correctly, no changes made (timeouts are meta-arguments)
✅ **Deferred Work:** No following.md exists, no deferred work to complete
✅ **Scope Compliance:** Only implemented timeouts.read, did not modify other timeout fields

### Compliance Statement

This implementation EXACTLY follows the special rules in `timeouts.md` for timeout meta-argument handling. The default value (5 minutes) was correctly extracted from the provider source code and applied in both the type definition and default block. The synchronization requirement is fully satisfied. No deviations found.

**Status:** APPROVED ✅

---
