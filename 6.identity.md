# Task #6 - identity - NOT APPLICABLE

## Summary

The `identity` block in the azurerm_resource_group resource definition is **NOT a user-facing schema field**. It is used exclusively for Terraform's plannable import feature (resource identity for hierarchical resource IDs). Therefore, NO implementation is required for this task - the `identity` block does not need to be migrated to azapi_resource as a user-configurable property.

## Planning Phase Misidentification

The task was created based on seeing `Identity: &schema.ResourceIdentity{}` in the resource definition:

```go
return &pluginsdk.Resource{
    Create:   resourceResourceGroupCreate,
    Read:     resourceResourceGroupRead,
    Update:   resourceResourceGroupUpdate,
    Delete:   resourceResourceGroupDelete,
    Importer: pluginsdk.ImporterValidatingIdentity(&commonids.ResourceGroupId{}),

    Timeouts: &pluginsdk.ResourceTimeout{
        Create: pluginsdk.DefaultTimeout(90 * time.Minute),
        Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
        Update: pluginsdk.DefaultTimeout(90 * time.Minute),
        Delete: pluginsdk.DefaultTimeout(90 * time.Minute),
    },

    Schema: map[string]*pluginsdk.Schema{
        "name": commonschema.ResourceGroupName(),
        "location": commonschema.Location(),
        "tags": commonschema.Tags(),
        "managed_by": {
            Type:         pluginsdk.TypeString,
            Optional:     true,
            ValidateFunc: validation.StringIsNotEmpty,
        },
    },

    Identity: &schema.ResourceIdentity{
        SchemaFunc: pluginsdk.GenerateIdentitySchema(&commonids.ResourceGroupId{}),
    },
}
```

However, this `Identity` field is **NOT part of the user-facing Schema map**. It's a separate field used for Terraform's plannable import functionality.

## Provider Schema Verification

**User-facing schema fields (Schema map):**
1. `name` - ✅ User-configurable
2. `location` - ✅ User-configurable
3. `tags` - ✅ User-configurable
4. `managed_by` - ✅ User-configurable

**NOT in Schema map:**
- `identity` - This is defined under `Identity: &schema.ResourceIdentity{}`, which generates import-only schema fields via `GenerateIdentitySchema()`

## How GenerateIdentitySchema Works

The `GenerateIdentitySchema()` function creates fields for **plannable import** (not user configuration):

```go
func identitySchema(id resourceids.ResourceId, idType ResourceTypeForIdentity) map[string]*schema.Schema {
    idSchema := make(map[string]*schema.Schema)
    segments := id.Segments()
    numSegments := len(segments)
    
    for idx, segment := range segments {
        if segmentTypeSupported(segment.Type) {
            name := segmentName(segment, idType, numSegments, idx)
            idSchema[name] = &schema.Schema{
                Type:              schema.TypeString,
                RequiredForImport: true,  // <-- Note: RequiredForImport, not user-facing
            }
        }
    }
    return idSchema
}
```

For `commonids.ResourceGroupId{}`, this generates fields like:
- `subscription_id` (RequiredForImport)
- `name` (RequiredForImport)

These are used when running `terraform import` with the plannable import feature, NOT for regular resource creation/updates.

## Evidence from CRUD Methods

**Create method:**
```go
func resourceResourceGroupCreate(d *pluginsdk.ResourceData, meta interface{}) error {
    // ... creation logic ...
    
    d.SetId(id.ID())
    if err := pluginsdk.SetResourceIdentityData(d, &id); err != nil {
        return err
    }
    // SetResourceIdentityData populates import-only fields, not user configuration
    
    return resourceResourceGroupRead(d, meta)
}
```

**Read method:**
```go
func resourceResourceGroupRead(d *pluginsdk.ResourceData, meta interface{}) error {
    // ... read logic ...
    
    d.Set("name", id.ResourceGroupName)
    if model := resp.Model; model != nil {
        d.Set("location", location.Normalize(model.Location))
        d.Set("managed_by", pointer.From(model.ManagedBy))
        if err = tags.FlattenAndSet(d, model.Tags); err != nil {
            return err
        }
    }

    return pluginsdk.SetResourceIdentityData(d, id)
    // SetResourceIdentityData is for import, not user-facing identity configuration
}
```

**Key observations:**
1. Create/Read methods call `SetResourceIdentityData()` - this is for setting import fields
2. NO code reads or sets a user-facing `identity` block
3. NO `d.Get("identity")` or `d.Set("identity")` calls anywhere
4. The Create method parameters struct has NO identity field:

```go
parameters := resourcegroups.ResourceGroup{
    Location: location.Normalize(d.Get("location").(string)),
    Tags:     tags.Expand(d.Get("tags").(map[string]interface{})),
}

if v := d.Get("managed_by").(string); v != "" {
    parameters.ManagedBy = pointer.To(v)
}
// NO identity field populated
```

## Azure API Verification

While the Azure API **does** support an `identity` property for Resource Groups (for Managed Identity), the azurerm provider **does not expose** this functionality to users.

**Azure API schema shows identity is supported:**
```json
{
  "identity": {
    "identity_ids": "A list of User Managed Identity ID's which should be assigned to the azure resource.",
    "principal_id": "The Principal ID for the Service Principal associated with the Managed Service Identity of this Azure resource.",
    "tenant_id": "The Tenant ID for the Service Principal associated with the Managed Service Identity of this Azure resource.",
    "type": "The Type of Identity which should be used for this azure resource. Possible values are `SystemAssigned`, `UserAssigned` and `SystemAssigned,UserAssigned`"
  }
}
```

**However,** azurerm_resource_group does not implement this. The provider maintainers chose not to expose Managed Identity for Resource Groups (possibly because it's rarely used or has limited use cases).

## Conclusion

The `identity` block is **NOT a user-facing configuration option** in azurerm_resource_group. It's an internal implementation detail for Terraform's plannable import feature. 

**NO IMPLEMENTATION NEEDED** for this task. The existing migrate_* files are correct and should not be modified.

## Task Status Recommendation

This task should be marked as **"Not Applicable - Not a user-facing schema field"** in track.md. The identity block seen in the resource definition is for import functionality only, not for user configuration, and therefore does not need migration to azapi_resource.

## Critical Review & Edge Case Analysis

**Null semantics:** N/A - field does not exist in user schema
**Boundary conditions:** N/A - field does not exist in user schema
**Idempotency:** N/A - field does not exist in user schema
**Safe references:** N/A - field does not exist in user schema

**Edge cases:**
- Azure API supports identity for Resource Groups, but azurerm provider doesn't expose it
- Users migrating to azapi_resource will NOT have identity blocks to migrate
- If users need Managed Identity for Resource Groups, they would need to use azapi_resource directly (not migrating from azurerm_resource_group)

## Checklist

- ✅ Verified identity is NOT in the Schema map
- ✅ Confirmed Identity field is for plannable import only
- ✅ Checked Create/Read/Update methods - no identity handling
- ✅ Verified Azure API supports identity but provider doesn't expose it
- ✅ Analyzed GenerateIdentitySchema function - generates RequiredForImport fields
- ✅ Confirmed NO user-facing identity configuration exists
- ✅ Documented that NO implementation is needed
- ✅ Self-review: Task correctly identified as not applicable

---

## ✅ CHECKER VALIDATION - APPROVED (NOT APPLICABLE)

**Checked by:** Checker Agent
**Date:** 2025-12-23
**Task:** #6 - identity

### Validation Results

✅ **Schema Verification:** Confirmed identity is NOT in the user-facing Schema map (verified via `query_terraform_schema` - only `id`, `location`, `managed_by`, `name`, `tags`, `timeouts` exist)
✅ **Identity Field Purpose:** Correctly identified as Terraform plannable import feature (`Identity: &schema.ResourceIdentity{}`), NOT user configuration
✅ **CRUD Method Analysis:** No user-facing identity handling in Create/Read/Update methods
✅ **Azure API Verification:** Azure API does support `identity` at root level, but azurerm provider doesn't expose it to users
✅ **Implementation Status:** No implementation needed - migrate_* files correctly do not include identity
✅ **Documentation:** Executor provided comprehensive analysis with evidence

### Compliance Statement

The executor correctly identified this task as **NOT APPLICABLE**. The `identity` field in the resource definition is exclusively for Terraform's plannable import functionality (generates `RequiredForImport` fields via `GenerateIdentitySchema()`), not a user-configurable property. The azurerm provider does not expose Azure Resource Group Managed Identity functionality to users, despite the Azure API supporting it.

**No implementation changes are required or appropriate for this task.**

### Recommendation

Task #6 should be marked as **"Not Applicable"** in track.md, not "Completed". This distinguishes between:
- "Completed" = Implementation done, field migrated
- "Not Applicable" = No implementation needed, field doesn't exist in user schema

**Status:** APPROVED AS NOT APPLICABLE ✅

---
