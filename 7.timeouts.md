# Task #7 - timeouts Block Structure Skeleton

## Summary

Created the structure skeleton for the `timeouts` block. This is a Terraform meta-argument (not an Azure API property) that controls operation timeout durations. No locals implementation is required - the parent module handles timeouts directly via the `azapi_resource` block. Added the `output "timeouts"` to `migrate_outputs.tf` to pass the timeouts value to the parent module.

## Shadow Implementation

```hcl
# migrate_outputs.tf
output "timeouts" {  # <- Added
  value = var.timeouts  # <- Added
}  # <- Added
```

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

From `resourceResourceGroup()` function:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(90 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(90 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(90 * time.Minute),
},
```

**Evidence:**
- The `timeouts` block is a resource-level meta-argument, not a request body property
- It controls the timeout duration for each CRUD operation
- Default values: Create=90m, Read=5m, Update=90m, Delete=90m
- These values are already documented in `variables.tf`

**Decision:** No implementation in `locals` required. The parent module uses the `var.timeouts` value directly in its `azapi_resource` block's `timeouts` argument.

## Assignment Path Verification

**Not Applicable:** The `timeouts` block is not part of the Azure API request body. It is a Terraform provider meta-argument.

## Provider Schema

From `resourceResourceGroup()`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(90 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(90 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(90 * time.Minute),
},
```

**Schema Details:**
- **Type:** Meta-argument block
- **Fields:** `create`, `read`, `update`, `delete` (all optional strings)
- **Purpose:** Controls maximum duration for CRUD operations

## Azure API Schema

**Not Applicable:** The `timeouts` block is not part of the Azure Resource Manager API schema. It is a Terraform-specific construct used by the provider to control operation timeouts.

## Hidden Fields

**None:** The `timeouts` block has no hidden fields. It contains only four standard optional string fields: `create`, `read`, `update`, and `delete`.

## Mapping

**Not Applicable:** The `timeouts` block does not map to any Azure API field. It is consumed directly by the Terraform provider for operation timeout control.

## Special Handling

### Timeouts Meta-Argument

According to `timeouts.md`:

1. **NOT implemented in shadow module's `locals`** - the timeouts are handled by the parent module's `azapi_resource` block
2. **Variable already exists** in `variables.tf` with correct type definition:
   ```hcl
   variable "timeouts" {
     type = object({
       create = optional(string)
       delete = optional(string)
       read   = optional(string)
       update = optional(string)
     })
     default     = null
     description = <<-EOT
      - `create` - (Defaults to 90 minutes) Used when creating the Resource Group.
      - `delete` - (Defaults to 90 minutes) Used when deleting the Resource Group.
      - `read` - (Defaults to 5 minutes) Used when retrieving the Resource Group.
      - `update` - (Defaults to 90 minutes) Used when updating the Resource Group.
     EOT
   }
   ```
3. **Output added** to `migrate_outputs.tf` to expose the timeouts value to the parent module

### Child Tasks Ready for Delegation

The following child tasks are now ready for implementation:

- **Task #8 (timeouts.create):** Update default value in `variables.tf` type definition to `optional(string, "90m")` and description
- **Task #9 (timeouts.delete):** Update default value in `variables.tf` type definition to `optional(string, "90m")` and description  
- **Task #10 (timeouts.read):** Update default value in `variables.tf` type definition to `optional(string, "5m")` and description
- **Task #11 (timeouts.update):** Update default value in `variables.tf` type definition to `optional(string, "90m")` and description

**Note:** According to `timeouts.md`, child tasks should:
1. Query provider source for timeout defaults (already documented above)
2. Update the `type` definition's `optional(string, "XXm")` with the correct default
3. Update the corresponding line in the `description` to reflect the default value
4. Document evidence in their proof
5. NO shadow module implementation required

## Critical Review & Edge Cases

### Edge Case Analysis

1. **Null Semantics:**
   - When `var.timeouts` is `null`, the parent module should use AzAPI provider's default timeouts
   - Individual timeout fields (create/read/update/delete) can be `null` - provider uses defaults for those operations

2. **Boundary Conditions:**
   - Timeout values must be valid duration strings (e.g., "90m", "1h30m")
   - Invalid timeout strings will be caught by the AzAPI provider at runtime
   - No validation needed in shadow module - provider handles this

3. **Idempotency:**
   - Timeout values don't affect resource state, only operation duration
   - Changes to timeouts don't trigger resource replacement
   - Safe to update at any time

4. **Safe References:**
   - Direct reference to `var.timeouts` is safe - variable has `default = null`
   - No nested access required

## Checklist

- ✅ Property in correct local: N/A (meta-argument, not in locals)
- ✅ ForceNew wrapped: N/A (timeouts don't trigger replacement)
- ✅ ALL logic EXACTLY replicated from provider: Yes (pass-through to parent module)
- ✅ Validations IMPLEMENTED: N/A (provider validates timeout strings)
- ✅ TODO comment added: N/A (no field migration)
- ✅ Hidden fields checked: None found
- ✅ Deferred work in following.md: None (structure-only task)
- ✅ Deferred work from following.md: None pending for this task
- ✅ Critical review: Completed (see Edge Case Analysis)
- ✅ Edge Case Analysis in proof: Included above
- ✅ Proof created: This document
- ✅ `track.md` updated: Next step
- ✅ Self-Review: Only added output for timeouts pass-through, no scope creep

## Implementation Evidence

**Changes Made:**

1. **migrate_outputs.tf:**
   - Added `output "timeouts"` to expose `var.timeouts` to parent module
   - This allows parent module to pass timeouts directly to its `azapi_resource` block

**No Changes Required:**

1. **migrate_main.tf:** No changes (timeouts not part of Azure API request)
2. **migrate_variables.tf:** No changes (variable already exists in `variables.tf`)
3. **variables.tf:** No changes for structure skeleton (child tasks will update defaults)

## Child Task Delegation

All child tasks (#8-11) are now **READY** for delegation. Each task should:

1. Update the `optional(string, "XXm")` default in the `type` definition
2. Update the corresponding description line
3. Create proof document with provider schema evidence
4. Update track.md status to "Pending for check"

**Expected Default Values (from provider schema):**
- `timeouts.create`: `"90m"`
- `timeouts.read`: `"5m"`
- `timeouts.update`: `"90m"`
- `timeouts.delete`: `"90m"`

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-23
**Task:** #7 - timeouts

### Validation Results

✅ **Scope Compliance:** Task correctly implemented ONLY the structure skeleton for timeouts block
✅ **Override Document:** Executor correctly read and followed `timeouts.md` rules before implementation
✅ **Output Created:** Added `output "timeouts"` to migrate_outputs.tf to pass var.timeouts to parent module
✅ **No Locals Implementation:** Correctly did NOT add timeouts to local.body or other locals (meta-argument, not Azure API)
✅ **No Variable Changes:** Correctly did NOT modify variables.tf (variable already exists with correct structure)
✅ **Proof Documentation:** Complete with all required sections including Create Phase Verification, Edge Case Analysis, and Checklist
✅ **No Scope Creep:** Only added timeouts output, no hidden fields or other content from future tasks
✅ **Child Task Preparation:** Correctly documented child tasks (#8-11) are ready for delegation with expected default values

### Compliance Statement

This implementation EXACTLY follows the rules in `timeouts.md` (override document) and `executor.md`. The executor correctly:
1. Detected the timeouts special case and read the override document first
2. Created only the output to pass timeouts to parent module
3. Did not implement timeouts in locals (correct - it's a meta-argument)
4. Did not modify the existing variable in variables.tf
5. Provided complete proof documentation with all required sections
6. Prepared child tasks with correct default values from provider schema

**Status:** APPROVED ✅

---
