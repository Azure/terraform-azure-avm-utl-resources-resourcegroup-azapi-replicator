# Task #8: timeouts.create - Implementation Proof

## Summary

Implemented `timeouts.create` by extracting the default timeout value (90 minutes) from the azurerm_resource_group provider source code and updating the `timeouts` variable in `variables.tf`. No shadow module implementation is required as timeouts are meta-arguments handled directly by the parent module's `azapi_resource` block.

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

The `timeouts` block is a Terraform provider meta-argument that controls operation timeout durations. It is NOT an Azure API property and therefore NOT sent in request bodies.

From `resourceResourceGroup()` in the provider source code:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(90 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(90 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(90 * time.Minute),
},
```

**Evidence:**
- Default value for `create`: **90 minutes** (`90 * time.Minute`)
- This is a resource-level meta-argument, not a request body property
- Timeouts control how long Terraform waits for operations to complete

## Assignment Path Verification

Not applicable - timeouts are not assigned to Azure API request bodies. They are consumed by the Terraform provider to control polling behavior during create/read/update/delete operations.

## Provider Schema

From `resourceResourceGroup()`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(90 * time.Minute), // <- create timeout
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(90 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(90 * time.Minute),
},
```

**Field Properties:**
- Type: Meta-argument (Terraform-level)
- Required: No (has default)
- Default: 90 minutes
- ForceNew: N/A (not an Azure API field)
- Sensitive: No

## Azure API Schema

Not applicable - timeouts are Terraform-specific meta-arguments and are not part of the Azure Resource Manager API schema.

## Hidden Fields

None - timeouts have no hidden fields.

## Mapping

Not applicable - no API mapping since this is a Terraform meta-argument.

## Special Handling

### Implementation in variables.tf

Updated the `timeouts` variable to include the default value in both the type definition and the default block, and set `nullable = false`:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "90m")  # <- Default value from provider
    delete = optional(string)
    read   = optional(string)
    update = optional(string)
  })
  default = {
    create = "90m"  # <- MUST match type definition per timeouts.md
  }
  nullable = false  # <- Required to prevent null values
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 90 minutes.
 - `delete` - (Defaults to 90 minutes) Used when deleting the Resource Group.
 - `read` - (Defaults to 5 minutes) Used when retrieving the Resource Group.
 - `update` - (Defaults to 90 minutes) Used when updating the Resource Group.
EOT
}
```

**Key Changes:**
1. Added `"90m"` default to `optional(string, "90m")` for the `create` field
2. Added `default = { create = "90m" }` block to synchronize with the type definition (per timeouts.md requirement)
3. Added `nullable = false` to prevent null values
4. Updated description for `create` field to match the format required

**Note:** Per `timeouts.md`, the `default` block values MUST be synchronized with the `optional(string, "XXm")` values in the type definition. This is a critical requirement.

### No Shadow Module Implementation

As documented in `timeouts.md`, there is NO implementation needed in the shadow module's `migrate_*` files. The timeouts are:
- Passed through via the existing `output "timeouts"` in `migrate_outputs.tf`
- Consumed directly by the parent module's `azapi_resource` block

The output already exists:
```hcl
output "timeouts" {
  value = var.timeouts
}
```

No changes to `migrate_main.tf`, `migrate_variables.tf`, or `migrate_validation.tf` are required.

## Deferred Work Completion

Checked `following.md` - file does not exist. No deferred work to complete.

## Critical Review & Edge Case Analysis

### Null Semantics
- **Variable-level null** (`default = null`): User can omit the entire `timeouts` block - valid and common
- **Field-level null** (`optional(string)` without default): Falls back to provider default when omitted
- **Field-level default** (`optional(string, "90m")`): Ensures `create` timeout always has a value when `timeouts` block is provided

### Edge Cases
1. **User omits entire timeouts block**: Provider uses all defaults (90m for create)
2. **User provides empty timeouts object `{}`**: The `create` field defaults to `"90m"` via `optional(string, "90m")`
3. **User provides custom create timeout**: User's value overrides the default

### Type Safety
- String format validated by azapi provider (e.g., "90m", "1h", "30s")
- Invalid duration strings will be caught by the azapi provider, not our module

### Idempotency
- Timeouts do not affect resource state, only operation behavior
- Same timeout values produce same results (no ordering concerns)

### Safe References
- Direct variable reference in output - no nested access needed
- No risk of null pointer errors

## Completion Checklist

- ✅ Property in correct location (variable definition, not locals)
- ✅ ForceNew: N/A (not an API field)
- ✅ ALL logic EXACTLY replicated from provider (extracted default timeout value)
- ✅ Validations: N/A (duration format validated by azapi provider)
- ✅ TODO comment: N/A (not a sensitive field migration)
- ✅ Hidden fields checked (none)
- ✅ Deferred work: Checked following.md (does not exist, no deferred work)
- ✅ Critical review completed (null, edge, idempotent, safe refs)
- ✅ Edge Case Analysis documented
- ✅ Proof created
- ✅ `track.md` will be updated to Pending for check
- ✅ Self-Review: Only implemented timeouts.create field as required by this task

---

## ⚠️ CHECKER VALIDATION - ISSUES FOUND AND CORRECTED

**Checked by:** Checker Agent
**Date:** 2025-12-23
**Task:** #8 - timeouts.create

### Issues Identified

#### Issue 1: Default Value Not Synchronized with Type Definition

**Problem:**
The executor correctly added `optional(string, "90m")` in the type definition but set `default = null` at the variable level. According to `timeouts.md` lines 44-78, this violates the critical synchronization requirement.

**Executor's Implementation:**
```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "90m")  # Default in type
    delete = optional(string)
    read   = optional(string)
    update = optional(string)
  })
  default  = null  # ❌ Not synchronized
  nullable = false
  # ...
}
```

**Why This Violates timeouts.md:**
From `timeouts.md` lines 44-48:
> **⚠️ CRITICAL REQUIREMENTS:**
> 1. **Sync `default` with `type` definition:** The values in the `default` block MUST exactly match the default values defined in the `optional(string, "XXm")` parameters in the `type` definition

And lines 61-66 show the required pattern:
```hcl
default = {
  create = "60m" # <- MUST match type definition: optional(string, "60m")
  # ...
}
```

**Expected Behavior:**
- When a field has `optional(string, "90m")` in the type definition, the `default` block must contain `create = "90m"`
- This ensures consistency between type-level defaults and variable-level defaults
- The synchronization is mandatory per `timeouts.md`

**Root Cause:**
Executor added the type-level default but missed the requirement to also add a synchronized default block.

### Corrections Made

#### Fix 1: Synchronized Default Block

**Changed Files:**
- `variables.tf`: Added synchronized default block
- `8.timeouts.create.md`: Updated proof documentation

**New Implementation:**
```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "90m")  # Type-level default
    delete = optional(string)
    read   = optional(string)
    update = optional(string)
  })
  default = {
    create = "90m"  # ✅ Synchronized with type definition
  }
  nullable = false
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 90 minutes.
 - `delete` - (Defaults to 90 minutes) Used when deleting the Resource Group.
 - `read` - (Defaults to 5 minutes) Used when retrieving the Resource Group.
 - `update` - (Defaults to 90 minutes) Used when updating the Resource Group.
EOT
}
```

**Why This is EXACT:**
- Matches `timeouts.md` requirement for synchronized defaults
- The `default` block value `"90m"` exactly matches the `optional(string, "90m")` parameter
- Ensures consistent behavior across all usage patterns
- Complies with the documented pattern in `timeouts.md` lines 61-66

**Verification:**
- Scenario 1: User omits entire timeouts block → Uses default `{ create = "90m" }` ✅
- Scenario 2: User provides empty timeouts object `{}` → Uses `optional()` default `"90m"` ✅
- Scenario 3: User provides custom create timeout → User's value overrides both defaults ✅
- Edge Case: User explicitly sets `create = null` → Blocked by type system (optional enforces string) ✅

### Validation Results

✅ **ForceNew Logic:** N/A (meta-argument, not an API field)
✅ **Stable Keys:** N/A (no replace_triggers needed)
✅ **Phase Detection:** N/A (timeouts are not part of request body)
✅ **Type Conversion:** Duration format validated by azapi provider
✅ **Null Handling:** Correctly handled via optional() and default block
✅ **Validations:** N/A (duration format validated by azapi provider)
✅ **Deferred Work Completion:** No deferred work for this task (following.md does not exist)
✅ **Deferred Work Recording:** No deferrals made
✅ **Edge Cases:** All edge cases properly analyzed and handled
✅ **Default Synchronization:** Now correctly synchronized between type and default block

### Compliance Statement

After corrections, this implementation now EXACTLY replicates the provider behavior and follows all requirements in `executor.md` and `timeouts.md`. The critical default value synchronization issue has been fixed.

**Status:** CORRECTED AND APPROVED ✅

---

## Shadow Implementation

```hcl
# variables.tf
variable "timeouts" {
  type = object({
    create = optional(string, "90m")  # <- Added default
    delete = optional(string)
    read   = optional(string)
    update = optional(string)
  })
  default = {
    create = "90m"  # <- Synchronized with type definition
  }
  nullable = false  # <- Added
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 90 minutes.  # <- Updated
 - `delete` - (Defaults to 90 minutes) Used when deleting the Resource Group.
 - `read` - (Defaults to 5 minutes) Used when retrieving the Resource Group.
 - `update` - (Defaults to 90 minutes) Used when updating the Resource Group.
EOT
}

# migrate_outputs.tf (already exists, no changes needed)
output "timeouts" {
  value = var.timeouts
}
```

**No changes to:**
- `migrate_main.tf`
- `migrate_variables.tf`
- `migrate_validation.tf`
